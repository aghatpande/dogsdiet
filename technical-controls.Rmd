---
title: "technical-controls"
author: "A. S. Ghatpande"
date: "5/8/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

There are multiple samples (sequencing libraries) representing different types of technical controls, viz, water, DNA extraction, mock etc. The descriptions are found in the "SampleName" column of the original 'runinfo.csv" and its derivative variables 

```{r, filtering runinfo for techcontrols}
techcntrlsRuninfo <- filtered_runinfo %>% filter (grepl("DNA_extract|Mock|Water", SampleName))
```

Generating a manifest file that Qiime2 needs for importing data

```{r, generating the techcontrols manifest file}
techcntrls_manifest <- allfastqs_manifest %>% filter (sampleid %in% techcntrlsRuninfo$Run)
techcntrls_manifest %>% write_tsv("techcntrlsManifest.tsv")
```

The .tsv file needs to be a tab separated *text* file for Qiime2 to import. This was done using the foll command at commmand line:

    cp techcntrlsManifest.tsv techcntrlsManifest
  
## 7. importing the technical controls data into Qiime2

  *Note the fastq.gz files need to be in the PWD for this step*. The import was done using the foll command in the *Qiime2 conda environment*:

      qiime tools import --type 'SampleData[PairedEndSequencesWithQuality]'\
      --input-path techcntrlsManifest\
      --output-path techcntrlsdemux.qza\
      --input-format PairedEndFastqManifestPhred33V2\
      ;

The important parameters are as specified above for the data in SRA, which was already demuliplexed and sorted into per sample data (likely barcodes removed). The data was fastq format with Phred scores. We *assumed* that the Phred score is Phred33 based since Illumina moved from Phred64 a while ago (per Shilpa)

The data was successfully imported with the foll: message from Qiime2

  Imported techcntrlsManifest as PairedEndFastqManifestPhred33V2 to techcntrlsdemux.qza



## 8. summarizing and visualizing the imported demultiplexed reads data

Following along the 'moving pictures' tutorial in Qiime 2 docs, we then generate a summary of the demulitplexed data in the *Qiime2 conda environment* and the /Users/asgghar/edu/metagenomics/beiting directory:

        qiime demux summarize --i-data techcntrlsdemux.qza\
                              --o-visualization techcntrlsdemux.qzv\
                              ;
    
Qiime 2 reported: Saved Visualization to: techcntrlsdemux.qzv

  The visualization is viewed using the command below in the same directory and environment:

        qiime tools view techcntrlsdemux.qzv

  *The UPenn team used an average Phred score of 20 for each sample and removed sequences >256 nt and < 250 nt in length per the paper*



## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
